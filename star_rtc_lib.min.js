var StarRtc=window.NameSpace||{};if(void 0===APP_PRODUCT_ID)var i=0,APP_PRODUCT_ID={R:i++,O:i++,t:i++,_:i++,s:i++,S:i++,i:i++,o:i++,N:i++,I:i++,A:i++};if(void 0===ACTION_GROUP_ID){i=0;var ACTION_GROUP_ID={M:i++,V:i++,C:i++,T:i++,P:i++,u:i++}}if(void 0===MSG_TYPE){i=0;var MSG_TYPE={L:i++,G:i++,l:i++,D:i++,p:i++}}if(void 0===MSG_DATA_TYPE){i=0;var MSG_DATA_TYPE={U:i++,v:i++,H:i++,k:i++}}if(void 0===ENCRYPT_TYPE){i=0;var ENCRYPT_TYPE={m:i++,g:i++}}if(void 0===AG_MSG_VOIP_CTRL)var AG_MSG_VOIP_CTRL={h:1e3,Y:1100,F:1001,W:1002,K:1003,B:1004};if(void 0===CHATROOM_LIST_TYPE){i=0;var CHATROOM_LIST_TYPE={J:i++,j:i++,X:i++,$:i++,q:i++,Z:i++,RR:i++}}if(void 0===AG_MSG){i=0;var AG_MSG={eR:i++,OR:i++,ER:i++,tR:i++,_R:i++,aR:i++,rR:i++,nR:i++,sR:i++,cR:i++,SR:i++,iR:i++,oR:i++,NR:i++,IR:i++,AR:i++,MR:i++,VR:i++,CR:i++,TR:i++,PR:i++,uR:i++,LR:i++,GR:i++,lR:i++,fR:i++,DR:i++,pR:i++,UR:i++,vR:i++,dR:i++,HR:i++,bR:i++,kR:i++,mR:i++,gR:i++,yR:i++,wR:i++,hR:i++,YR:i++,xR:i++,FR:i++,WR:i++,KR:i++,BR:i++}}if(void 0===CHAT_ROOM_TYPE){i=1;var CHAT_ROOM_TYPE={JR:i++,QR:i++}}if(void 0===AG_CHATROOMMOONSERVER){i=0;var AG_CHATROOMMOONSERVER={jR:i++,XR:i++,$R:i++,qR:i++,zR:i++,ZR:i++,Re:i++,ee:i++,Oe:i++,Ee:i++,te:i++,_e:i++,ae:i++,re:i++,ne:i++,se:i++,ce:i++,Se:i++,ie:i++,oe:i++,Ne:i++,Ie:i++,Ae:i++,Me:i++,Ve:i++,Ce:i++,Te:i++,Pe:i++,ue:i++,Le:i++,Ge:i++,le:i++,fe:i++,De:i++,pe:i++,Ue:i++,ve:i++,de:i++,He:i++,be:i++,ke:i++,me:i++,ge:i++,ye:i++,we:i++}}if(void 0===AG_VOIPMOONSERVER){i=0;var AG_VOIPMOONSERVER={he:i++,Ye:i++,xe:i++,Fe:i++,We:i++,Ke:i++,Be:i++,Je:i++,Qe:i++,je:i++,Xe:i++,$e:i++,qe:i++,ze:i++,Ze:i++,RO:i++,eO:i++,OO:i++,EO:i++,tO:i++,_O:i++,aO:i++,rO:i++,nO:i++,sO:i++,cO:i++,SO:i++,iO:i++,oO:i++,NO:i++,IO:i++,AO:i++,MO:i++,VO:i++,CO:i++,TO:i++,PO:i++,uO:i++,LO:i++}}if(void 0===AG_LIVESRCMOONSERVER){i=0;var AG_LIVESRCMOONSERVER={GO:i++,lO:i++,fO:i++,DO:i++,pO:i++,UO:i++,vO:i++,dO:i++,HO:i++,bO:i++,kO:i++,mO:i++,gO:i++,yO:i++,wO:i++,hO:i++,YO:i++,xO:i++,FO:i++,WO:i++,KO:i++,BO:i++,JO:i++,QO:i++,jO:i++,XO:i++,$O:i++,qO:i++,zO:i++,ZO:i++,RE:i++,eE:i++,OE:i++,EE:i++,tE:i++,_E:i++,aE:i++,rE:i++,nE:i++,sE:i++,cE:i++,SE:i++,iE:i++,oE:i++,NE:i++,IE:i++,AE:i++,ME:i++,VE:i++,CE:i++,TE:i++,PE:i++,uE:i++,LE:i++,GE:i++,lE:i++,fE:i++,DE:i++,pE:i++,UE:i++,vE:i++,dE:i++,HE:i++}}if(void 0===AG_LIVEVDNMOONSERVER){i=0;var AG_LIVEVDNMOONSERVER={bE:i++,kE:i++,mE:i++,gE:i++,yE:i++,wE:i++,hE:i++,YE:i++,xE:i++,FE:i++,WE:i++,KE:i++,BE:i++,JE:i++,QE:i++,jE:i++,XE:i++,$E:i++,qE:i++,zE:i++,ZE:i++,Rt:i++,et:i++}}function clone(R){if(null==R||"object"!=typeof R)return R;if(R instanceof Date)return(e=new Date).setTime(R.getTime()),e;if(R instanceof Array){for(var e=[],O=R.length,E=0;E<O;++E)e[E]=clone(R[E]);return e}if(R instanceof Object){e={};for(var t in R)R.hasOwnProperty(t)&&(e[t]=clone(R[t]));return e}throw new Error("Unable to copy obj! Its type isn't supported.")}StarRtc.AUtils=new function(){var o,N=this,H="",b="",k="",m="";function C(R,e){for(var O=w(R),E=h(g(O.length.toString(16))),t=w(e),_=h(g(t.length.toString(16))),a=new Uint8Array(O.length+t.length+8),r=0,n=E.length,s=r;s<n;s++)a[s]=E[s-r];n=(r=n)+O.length;for(s=r;s<n;s++)a[s]=O[s-r];n=(r=n)+_.length;for(s=r;s<n;s++)a[s]=_[s-r];n=(r=n)+t.length;for(s=r;s<n;s++)a[s]=t[s-r];return a}function I(R){var e=new Uint8Array(R),O=0,E=parseInt("0x"+V(e.slice(O,O+4)));O+=4;var t=M(e.slice(O,O+E));O+=E;var _=parseInt("0x"+V(e.slice(O,O+4)));return O+=4,{digest:t,content:M(e.slice(O,O+_))}}function g(R){var e=8-R.length;return"00000000".substr(0,e)+R}function y(R){var e=4-R.length;return"0000".substr(0,e)+R}function A(R,e){var O=new Array(R+1).join("0"),E=R-e.length;return O.substr(0,E)+e}function w(R){var e,O,E=new Array;e=R.length;for(var t=0;t<e;t++)65536<=(O=R.charCodeAt(t))&&O<=1114111?(E.push(O>>18&7|240),E.push(O>>12&63|128),E.push(O>>6&63|128),E.push(63&O|128)):2048<=O&&O<=65535?(E.push(O>>12&15|224),E.push(O>>6&63|128),E.push(63&O|128)):128<=O&&O<=2047?(E.push(O>>6&31|192),E.push(63&O|128)):E.push(255&O);return E}function M(R){if("string"==typeof R)return R;for(var e="",O=R,E=0;E<O.length;E++){var t=O[E].toString(2),_=t.match(/^1+?(?=0)/);if(_&&8==t.length){for(var a=_[0].length,r=O[E].toString(2).slice(7-a),n=1;n<a;n++)r+=O[n+E].toString(2).slice(2);e+=String.fromCharCode(parseInt(r,2)),E+=a-1}else e+=String.fromCharCode(O[E])}return e}function h(R){var e=0,O=R.length;if(O%2!=0)return null;O/=2;for(var E=new Array,t=0;t<O;t++){var _=R.substr(e,2),a=parseInt("0x"+_);E.push(a),e+=2}return E}function V(R){for(var e="",O=0;O<R.length;O++){var E=R[O].toString(16);1==E.length&&(E="0"+E),e+=E}return e}function Y(R,e,O){var E=e;for(var t in O)for(var _=O[t],a=0;a<_.length;a++,E++)R[E]=_[a]}N.msgMaxLen=0,N.setUserInfo=function(R,e,O){k=(H=R)+"_"+(b=e),m=O},N.clear=function(){m=k=b=H="",N.msgMaxLen=0,clearInterval(o)},N.parseProtocol=function(R,c){var e=new Blob([R],{type:"text/plain"}),S=new FileReader;S.readAsArrayBuffer(e),S.onload=function(R){var e=new Uint8Array(S.result);console.info("parseProtocol:",e);var O=e[0],E=e.slice(1,5),t=e[5],_=e.slice(6,8),a=e.slice(8,10),r=e[10],n=e.slice(11,e.byteLength-2);console.info("parseProtocol: msgArr = ",n);var s=e.slice(e.byteLength-2,e.byteLength);c({appid:O,plength:E,appver:t,rese1:_,rese2:a,actionid:r,msgArr:n,end:s})}},N.packageProtocol=function(R,e,O){var E=R,t=new Array(255,255),_=new Array(255,255),a=e,r=(new Array(18,52),O),n=new Uint8Array(r),s=h(g((r.byteLength+12).toString(16))),c=new ArrayBuffer(r.byteLength+13),S=new Uint8Array(c);S[0]=E;for(var i=1;i<5;i++)S[i]=s[i-1];S[5]=1,S[6]=t[0],S[7]=t[1],S[8]=_[0],S[9]=_[1],S[10]=a;for(i=11;i<11+n.byteLength;i++)S[i]=n[i-11];return S[11+n.byteLength]=18,S[12+n.byteLength]=52,console.log("packageProtocol",S),S},N.constructAuthMsg=function(){for(var R=h(y(AG_MSG.eR.toString(16))),e=w(k),O=h(y(e.length.toString(16))),E=w(m),t=new Uint8Array(e.length+36),_=0,a=R.length,r=_;r<a;r++)t[r]=R[r];a=(_=a)+O.length;for(r=_;r<a;r++)t[r]=O[r-_];a=(_=a)+e.length;for(r=_;r<a;r++)t[r]=e[r-_];a=(_=a)+E.length;for(r=_;r<a;r++)t[r]=E[r-_];_=0;var n=[];return n.push(R),n.push(O),n.push(e),n.push(E),Y(t,_,n),t},N.constructSingleMsg=function(R,e,O,E,t){var _=h(y(AG_MSG.aR.toString(16))),a=w(k),r=h(y(a.length.toString(16))),n=w(H+"_"+R),s=h(y(n.length.toString(16))),c=h(g(e.toString(16))),S=ENCRYPT_TYPE.m,i=MSG_DATA_TYPE.v;null!=t&&(i=t);var o={fromId:b,targetId:R,time:"0",msgIndex:e,type:1,code:0,contentData:E},N=C(O,JSON.stringify(o)),I=h(g(N.length.toString(16))),A=new Uint8Array(a.length+n.length+N.length+16),M=[];return M.push(_),M.push(r),M.push(a),M.push(s),M.push(n),M.push(c),M.push([S]),M.push([i]),M.push(I),M.push(N),Y(A,0,M),A},N.constructGroupMsg=function(R,e,O,E){var t=h(y(AG_MSG.IR.toString(16))),_=w(""),a=h(y(_.length.toString(16))),r=h(g(e.toString(16))),n=w(H+"_"+R),s=h(y(n.length.toString(16))),c=w(k),S=h(y(c.length.toString(16))),i=ENCRYPT_TYPE.m,o=MSG_DATA_TYPE.v,N={fromId:b,targetId:R,time:"0",msgIndex:e,type:1,code:0,contentData:E},I=C(O,JSON.stringify(N)),A=h(g(I.length.toString(16))),M=new Uint8Array(_.length+n.length+c.length+I.length+18),V=[];return V.push(t),V.push(a),V.push(_),V.push(r),V.push(s),V.push(n),V.push(S),V.push(c),V.push([i]),V.push([o]),V.push(A),V.push(I),Y(M,0,V),M},N.constructReceivedMsg=function(R){var e=h(y(AG_MSG.DR.toString(16))),O=w(k),E=h(y(O.length.toString(16))),t=new Uint8Array(R),_=new Uint8Array(O.length+12),a=[];return a.push(e),a.push(E),a.push(O),a.push(t),Y(_,0,a),_},N.constructSingleCtrlMsg=function(R,e,O,E,t){var _=h(y(AG_MSG.aR.toString(16))),a=w(k),r=h(y(a.length.toString(16))),n=w(H+"_"+R),s=h(y(n.length.toString(16))),c=h(g(e.toString(16))),S=ENCRYPT_TYPE.m,i=MSG_DATA_TYPE.U,o={fromId:b,targetId:R,time:"0",msgIndex:e,type:0,code:parseInt(t),contentData:E},N=C(O,JSON.stringify(o)),I=h(g(N.length.toString(16))),A=new Uint8Array(a.length+n.length+N.length+16),M=[];return M.push(_),M.push(r),M.push(a),M.push(s),M.push(n),M.push(c),M.push([S]),M.push([i]),M.push(I),M.push(N),Y(A,0,M),A},N.constructVOIPProtocol=function(R,e){var O,E=[],t=h(y(R.toString(16))),_=w(k),a=h(y(_.length.toString(16))),r=w(m),n=h(y(r.length.toString(16)));switch(R){case AG_VOIPMOONSERVER.Fe:case AG_VOIPMOONSERVER.Ke:var s=w(H+"_"+e.targetId),c=h(y(s.length.toString(16))),S=h(A(8,parseInt(e.audioSSRC).toString(16))),i=h(A(8,parseInt(e.videoSSRC).toString(16))),o=h(A(2,parseInt(e.videoCodec).toString(16))),N=h(A(2,parseInt(e.audioCodec).toString(16)));O=new Uint8Array(2+(2+_.length)+(2+r.length)+(2+s.length)+4+4+1+1),E.push(t),E.push(a),E.push(_),E.push(n),E.push(r),E.push(c),E.push(s),E.push(S),E.push(i),E.push(o),E.push(N);break;case AG_VOIPMOONSERVER.Qe:var I=e.isActive;O=new Uint8Array(3),E.push(t),E.push([I])}return Y(O,0,E),O},N.constructSrcProtocol=function(R,e){var O,E=[],t=h(y(R.toString(16))),_=h(y((N=w(k)).length.toString(16))),a=h(y((I=w(m)).length.toString(16)));switch(R){case AG_LIVESRCMOONSERVER.xO:case AG_LIVESRCMOONSERVER.FO:var r=h(y(e.conCurrentNum.toString(16))),n=h(y((0).toString(16))),s=h(y((i=w(e.roomId)).length.toString(16))),c=e.liveType,S=h(y((V=w(e.extra)).length.toString(16)));O=new Uint8Array(2+(2+N.length)+(2+I.length)+2+2+(2+i.length)+1+(2+V.length)),E.push(t),E.push(_),E.push(N),E.push(a),E.push(I),E.push(r),E.push(n),E.push(s),E.push(i),E.push([c]),E.push(S),E.push(V);break;case AG_LIVESRCMOONSERVER.WO:r=h(y(e.conCurrentNum.toString(16))),n=h(y(e.validTime.toString(16))),s=h(y((i=w(e.roomId)).length.toString(16))),S=h(y((V=w(e.extra)).length.toString(16)));var i,o=h(y((C=w(e.spec)).length.toString(16)));E.push(t),E.push(_),E.push(N),E.push(a),E.push(I),E.push(r),E.push(n),E.push(s),E.push(i),E.push(S),E.push(V),E.push(o),E.push(C);break;case AG_LIVESRCMOONSERVER.KO:t=h(y(R.toString(16))),_=h(y((N=w(b)).length.toString(16))),a=h(y((I=w(m)).length.toString(16))),n=h(y((0).toString(16)));var N,I,A=h(y((M=w(e.groupId)).length.toString(16)));S=h(y((V=w(e.extra)).length.toString(16)));E.push(t),E.push(_),E.push(N),E.push(a),E.push(I),E.push(n),E.push(A),E.push(M),E.push(S),E.push(V);break;case AG_LIVESRCMOONSERVER.BO:var M,V,C;n=h(y((0).toString(16))),A=h(y((M=w(e.groupId)).length.toString(16))),S=h(y((V=w(e.extra)).length.toString(16))),o=h(y((C=w(e.spec)).length.toString(16)));E.push(t),E.push(_),E.push(N),E.push(a),E.push(I),E.push(n),E.push(A),E.push(M),E.push(S),E.push(V),E.push(o),E.push(C);break;case AG_LIVESRCMOONSERVER.JO:var T=w(e.channelId),P=w(e.avParam),u=h(y(P.length.toString(16)));E.push(t),E.push(_),E.push(N),E.push(a),E.push(I),E.push(T),E.push(u),E.push(P);break;case AG_LIVESRCMOONSERVER.jO:T=w(e.channelId);var L=h(y((G=w(e.upUserId)).length.toString(16)));E.push(t),E.push(_),E.push(N),E.push(a),E.push(I),E.push(T),E.push(L),E.push(G);break;case AG_LIVESRCMOONSERVER.XO:case AG_LIVESRCMOONSERVER.$O:case AG_LIVESRCMOONSERVER.qO:var G;T=w(e.channelId),L=h(y((G=w(e.upUserId)).length.toString(16)));E.push(t),E.push(_),E.push(N),E.push(a),E.push(I),E.push(T),E.push(L),E.push(G);break;case AG_LIVESRCMOONSERVER.zO:case AG_LIVESRCMOONSERVER.ZO:T=w(e.channelId);O=new Uint8Array(2+(2+N.length)+(2+I.length)+16),E.push(t),E.push(_),E.push(N),E.push(a),E.push(I),E.push(T);break;case AG_LIVESRCMOONSERVER.RE:for(var l=e.streamConfig,f=new Uint8Array(16),D=0;D<16;D++)null!=l[D]?f[D]=l[D]:f[D]=0;O=new Uint8Array(18),E.push(t),E.push(f);break;case AG_LIVESRCMOONSERVER.eE:T=w(e.channelId);E.push(t),E.push(T);break;case AG_LIVESRCMOONSERVER.EE:E.push(t);break;case AG_LIVESRCMOONSERVER.OE:var p=w(e.streamData);O=new Uint8Array(3+p.length),E.push(t),E.push([e.streamDataType]),E.push(p)}return Y(O,0,E),O},N.constructVdnProtocol=function(R,e){var O,E=[],t=h(y(R.toString(16))),_=w(k),a=h(y(_.length.toString(16))),r=w(m),n=h(y(r.length.toString(16)));switch(R){case AG_LIVEVDNMOONSERVER.mE:var s=h(A(8,parseInt(e.ssrc).toString(16))),c=h(A(2,parseInt(e.videoCodec).toString(16))),S=h(A(2,parseInt(e.audioCodec).toString(16)));O=new Uint8Array(8),E.push(t),E.push(s),E.push(c),E.push(S);break;case AG_LIVEVDNMOONSERVER.gE:var i=w(e.channelId);O=new Uint8Array(18+(2+_.length)+(2+r.length)),E.push(t),E.push(i),E.push(a),E.push(_),E.push(n),E.push(r);break;case AG_LIVEVDNMOONSERVER.yE:case AG_LIVEVDNMOONSERVER.wE:O=new Uint8Array(2),E.push(t);break;case AG_LIVEVDNMOONSERVER.xE:case AG_LIVEVDNMOONSERVER.hE:i=w(e.channelId);O=new Uint8Array(18),E.push(t),E.push(i);break;case AG_LIVEVDNMOONSERVER.YE:for(var o=e.streamConfig,N=new Uint8Array(16),I=0;I<16;I++)null!=o[I]?N[I]=o[I]:N[I]=0;O=new Uint8Array(18),E.push(t),E.push(N)}return Y(O,0,E),O},N.constructChatProtocol=function(R,e){var O,E=[],t=h(y(R.toString(16))),_=w(k),a=h(y(_.length.toString(16))),r=w(m),n=h(y(r.length.toString(16)));if(R==AG_CHATROOMMOONSERVER.jR){var s=e.roomType,c=h(y(e.conCurrentNum.toString(16))),S=h(g((l=w(e.userDefineData)).length.toString(16)));O=new Uint8Array(2+(2+_.length)+(2+r.length)+1+2+(4+l.length)),E.push(t),E.push(a),E.push(_),E.push(n),E.push(r),E.push([s]),E.push(c),E.push(S),E.push(l)}else if(R==AG_CHATROOMMOONSERVER.XR)O=new Uint8Array(2),E.push(t);else if(R==AG_CHATROOMMOONSERVER.$R){var i=w(H+"_"+e.banUserId),o=h(y(i.length.toString(16))),N=h(y(e.banTime.toString(16)));O=new Uint8Array(2+(2+i.length)+2),E.push(t),E.push(o),E.push(i),E.push(N)}else if(R==AG_CHATROOMMOONSERVER.qR){var I=w(H+"_"+e.kickOutUserId),A=h(y(I.length.toString(16)));O=new Uint8Array(2+(2+I.length)),E.push(t),E.push(A),E.push(I)}else if(R==AG_CHATROOMMOONSERVER.zR)O=new Uint8Array(2),E.push(t);else if(R==AG_CHATROOMMOONSERVER.ZR){var M=w(e.roomId);O=new Uint8Array(2+(2+_.length)+(2+r.length)+16),E.push(t),E.push(a),E.push(_),E.push(n),E.push(r),E.push(M)}else if(R==AG_CHATROOMMOONSERVER.Re);else if(R==AG_CHATROOMMOONSERVER.ee)O=new Uint8Array(2),E.push(t);else if(R==AG_CHATROOMMOONSERVER.Oe){var V={fromId:b,targetId:e.roomId,time:"0",msgIndex:e.msgIndex,type:1,code:0,contentData:e.msg},C=w(JSON.stringify(V)),T=h(g(C.length.toString(16)));O=new Uint8Array(2+(4+C.length)),E.push(t),E.push(T),E.push(C)}else if(R==AG_CHATROOMMOONSERVER.Ee){V={fromId:b,targetId:e.roomId,time:"0",msgIndex:e.msgIndex,type:parseInt(e.type),code:parseInt(e.code),contentData:e.msg};var P=w(JSON.stringify(V)),u=h(g(P.length.toString(16))),L=w(H+"_"+e.toUserId),G=h(y(L.length.toString(16)));O=new Uint8Array(2+(2+L.length)+(4+P.length)),E.push(t),E.push(G),E.push(L),E.push(u),E.push(P)}else if(R==AG_CHATROOMMOONSERVER.te){M=w(e.roomId);O=new Uint8Array(18),E.push(t),E.push(M)}else if(R==AG_CHATROOMMOONSERVER.de){var l,f=h(y((p=w(b)).length.toString(16))),D=h(y(e.listType.toString(16)));S=h(g((l=w(e.userDefineData)).length.toString(16))),M=w(e.roomId);O=new Uint8Array(4+(2+p.length)+16+(4+l.length)),E.push(t),E.push(D),E.push(f),E.push(p),E.push(M),E.push(S),E.push(l)}else if(R==AG_CHATROOMMOONSERVER.ke){D=h(y(e.listType.toString(16))),M=w(e.roomId);O=new Uint8Array(4+(2+_.length)+16),E.push(t),E.push(D),E.push(a),E.push(_),E.push(M)}else if(R==AG_CHATROOMMOONSERVER.ye){var p,U=w(e.listTypes),v=h(y(U.length.toString(16))),d=h(y((p=w(e.userId)).length.toString(16)));O=new Uint8Array(2+(2+U.length)+(2+p.length)),E.push(t),E.push(v),E.push(U),E.push(d),E.push(p)}return Y(O,0,E),O},N.constructWebrtcUploadMsgProtocol=function(R){var e=h(y(AG_LIVESRCMOONSERVER.QO.toString(16))),O=w(k),E=h(y(O.length.toString(16))),t=w(m),_=h(y(t.length.toString(16))),a=w(R.channelId),r=h(A(8,parseInt(R.audioSSRC).toString(16))),n=h(A(8,parseInt(R.smallVideoSSRC).toString(16))),s=h(A(8,parseInt(R.bigVideoSSRC).toString(16))),c=h(A(2,parseInt(R.videoCodec).toString(16))),S=h(A(2,parseInt(R.audioCodec).toString(16))),i=new Uint8Array(O.length+t.length+34+1+1);return Y(i,0,[e,E,O,_,t,a,r,n,s,c,S]),i},N.parseMessage=function(R){var e,O=new Uint8Array(R);switch(parseInt("0x"+V(O.slice(0,2)))){case AG_MSG.OR:O=new Uint8Array(R);StarRtc.AUtils.msgMaxLen=parseInt("0x"+V(O.slice(2,4))),console.log("登录成功，最大消息长度：",StarRtc.AUtils.msgMaxLen),StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.M,N.constructHeartBeatMsg(AG_MSG.tR))),o=setInterval(function(){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.M,N.constructHeartBeatMsg(AG_MSG.tR)))},15e3),StarRtc.StarManager.getLoginMessage({status:"success"});break;case AG_MSG.ER:console.log("登录失败"),StarRtc.StarManager.getLoginMessage({status:"failed"});break;case AG_MSG._R:console.log("心跳反馈");break;case AG_MSG.lR:console.log("服务器收到消息");break;case AG_MSG.fR:console.log("收到消息");parseInt("0x"+V(O.slice(10,14)));var E=15;switch(O[14]){case MSG_TYPE.L:console.log("单聊消息");var t=parseInt("0x"+V(O.slice(E,E+2)));E+=2;var _=M(O.slice(E,E+t)),a=O[E+=t];switch(E+=1,a){case ENCRYPT_TYPE.m:var r=parseInt("0x"+V(O.slice(E,E+4)));E+=4;var n=I(O.slice(E,E+r));console.log(_,n.digest,n.content),StarRtc.StarManager.getSingleMessage(_,n.digest,n.content);break;case ENCRYPT_TYPE.g:}break;case MSG_TYPE.G:console.log("群消息");var s=parseInt("0x"+V(O.slice(E,E+2)));E+=2;var c=M(O.slice(E,E+s));E+=s;t=parseInt("0x"+V(O.slice(E,E+2)));E+=2;_=M(O.slice(E,E+t)),a=O[E+=t];switch(E+=1,a){case ENCRYPT_TYPE.m:r=parseInt("0x"+V(O.slice(E,E+4)));E+=4;n=I(O.slice(E,E+r));console.log(c,_,n.digest,n.content),StarRtc.StarManager.getGroupMessage(c,_,n.digest,n.content);break;case ENCRYPT_TYPE.g:}break;case MSG_TYPE.l:console.log("群私信消息");s=parseInt("0x"+V(O.slice(E,E+2)));E+=2;c=M(O.slice(E,E+s));E+=s;t=parseInt("0x"+V(O.slice(E,E+2)));E+=2;_=M(O.slice(E,E+t)),a=O[E+=t];switch(E+=1,a){case ENCRYPT_TYPE.m:r=parseInt("0x"+V(O.slice(E,E+4)));E+=4;n=I(O.slice(E,E+r));console.log(c,_,n.digest,n.content),StarRtc.StarManager.getGroupPrivateMessage(c,_,n.digest,n.content);break;case ENCRYPT_TYPE.g:}break;case MSG_TYPE.D:console.log("推送群信息");s=parseInt("0x"+V(O.slice(E,E+2)));E+=2;c=M(O.slice(E,E+s));E+=s;r=parseInt("0x"+V(O.slice(E,E+4)));E+=4;n=I(O.slice(E,E+r));console.log(c,n.digest,n.content),StarRtc.StarManager.getGroupPushMessage(c,n.digest,n.content);break;case MSG_TYPE.p:console.log("推送系统信息");r=parseInt("0x"+V(O.slice(E,E+4)));E+=4;n=I(O.slice(E,E+r));console.log(n.digest,n.content),StarRtc.StarManager.getSystemPushMessage(n.digest,n.content)}e=O.slice(2,10),console.log("发送消息回执"),StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.M,StarRtc.AUtils.constructReceivedMsg(e)));break;case AG_MSG.pR:var S=parseInt("0x"+V(O.slice(2,4))),i=M(O.slice(6,O.byteLength));console.log("报错:",S,i),StarRtc.StarManager.getErrorMessage(S,i)}},N.parseSrcMoonServerMessage=function(R,e){var O=new Uint8Array(R);switch(parseInt("0x"+V(O.slice(0,2)))){case AG_LIVESRCMOONSERVER.rE:V(O.slice(18,20));var E=parseInt("0x"+V(O.slice(18,20)));e({type:"srcApplyUpload",status:"success",fingerprint:M(O.slice(20,20+E))});break;case AG_LIVESRCMOONSERVER.nE:var t=parseInt("0x"+V(O.slice(2,4)));e({type:"srcApplyUpload",status:"failed",msg:i=M(O.slice(4,4+t))});break;case AG_LIVESRCMOONSERVER.pE:console.log("webrtc心跳反馈");break;case AG_LIVESRCMOONSERVER.UE:for(var _=parseInt("0x"+V(O.slice(2,3))),a=3,r=O.length,n={siv:_,uperInfos:{}};a<r;){var s=parseInt("0x"+V(O.slice(a,a+1)));a+=1;var c=parseInt("0x"+V(O.slice(a,a+2)));a+=2;var S=M(O.slice(a,a+c));a+=c,n.uperInfos[s]={upId:s,userId:S}}e({type:"uperStreamInfoUpdate",status:"success",msg:n});break;case AG_LIVESRCMOONSERVER.DE:e({type:"stopStream",status:"success"});break;case AG_LIVESRCMOONSERVER.uE:e({type:"streamConfig",status:"success",channelId:M(O.slice(2,18))});break;case AG_LIVESRCMOONSERVER.LE:e({type:"streamConfig",status:"failed",channelId:M(O.slice(2,18))});break;case AG_LIVESRCMOONSERVER.TE:e({type:"delChannel",status:"success",channelId:M(O.slice(2,18))});break;case AG_LIVESRCMOONSERVER.PE:t=parseInt("0x"+V(O.slice(2,4)));var i=M(O.slice(4,4+t));e({type:"delChannel",status:"failed",channelId:M(O.slice(4+t,4+t+16)),msg:i});break;case AG_LIVESRCMOONSERVER.tE:e({type:"createChannel",status:"success",channelId:M(O.slice(2,18))});break;case AG_LIVESRCMOONSERVER._E:t=parseInt("0x"+V(O.slice(2,4)));e({type:"createChannel",status:"failed",msg:i=M(O.slice(4,4+t))});break;case AG_LIVESRCMOONSERVER.vE:s=parseInt("0x"+V(O.slice(2,3))),_=parseInt("0x"+V(O.slice(3,4)));var o=M(O.slice(5));e({type:"streamData",status:"success",upId:s,siv:_,streamDataType:parseInt("0x"+V(O.slice(4,5))),streamData:o});break;case AG_LIVESRCMOONSERVER.dE:(i={}).errId=parseInt("0x"+V(O.slice(2,4))),i.errStrlen=parseInt("0x"+V(O.slice(4,6))),i.errStr=M(O.slice(6,6+i.errStrlen)),e({type:"serverErr",status:"failed",msg:i})}},N.parseVdnMoonServerMessage=function(R,e){var O=new Uint8Array(R);switch(parseInt("0x"+V(O.slice(0,2)))){case AG_LIVEVDNMOONSERVER.FE:var E=parseInt("0x"+V(O.slice(2,4)));e({type:"vdnWebrtcReg",status:"success",fingerprint:M(O.slice(4,4+E))});break;case AG_LIVEVDNMOONSERVER.WE:for(var t=M(O.slice(2,18)),_=parseInt("0x"+V(O.slice(18,19))),a=19,r=O.length,n={siv:_,uperInfos:{}};a<r;){var s=parseInt("0x"+V(O.slice(a,a+1)));a+=1;var c=parseInt("0x"+V(O.slice(a,a+2)));a+=2;var S=M(O.slice(a,a+c));a+=c,n.uperInfos[s]={upId:s,userId:S}}e({type:"vdnApplyDownload",status:"success",channelId:t,uperInfos:n});break;case AG_LIVEVDNMOONSERVER.KE:console.log("vdn 心跳反馈");break;case AG_LIVEVDNMOONSERVER.BE:var i=parseInt("0x"+V(O.slice(2,4))),o=M(O.slice(4,4+i));e({type:"vdnApplyDownload",status:"failed",channelId:t=M(O.slice(4+i,4+i+16)),failedStatus:o});break;case AG_LIVEVDNMOONSERVER.JE:e({type:"streamConfig",status:"success",channelId:t=M(O.slice(2,18))});break;case AG_LIVEVDNMOONSERVER.QE:e({type:"streamConfig",status:"failed",channelId:t=M(O.slice(2,18))});break;case AG_LIVEVDNMOONSERVER.jE:for(t=M(O.slice(2,18)),_=parseInt("0x"+V(O.slice(18,19))),a=19,r=O.length,n={channelId:t,siv:_,uperInfos:{}};a<r;){s=parseInt("0x"+V(O.slice(a,a+1)));a+=1;c=parseInt("0x"+V(O.slice(a,a+2)));a+=2;S=M(O.slice(a,a+c));a+=c,n.uperInfos[s]={upId:s,userId:S}}e({type:"uperStreamInfoUpdate",status:"success",channelId:t,msg:n});break;case AG_LIVEVDNMOONSERVER.XE:e({type:"streamData",status:"success",upId:s=parseInt("0x"+V(O.slice(2,3))),siv:_=parseInt("0x"+V(O.slice(3,4))),streamDataType:parseInt("0x"+V(O.slice(4,5))),streamData:M(O.slice(5))});break;case AG_LIVEVDNMOONSERVER.$E:case AG_LIVEVDNMOONSERVER.qE:case AG_LIVEVDNMOONSERVER.zE:break;case AG_LIVEVDNMOONSERVER.Rt:var N={};N.errId=parseInt("0x"+V(O.slice(2,4))),N.errStrlen=parseInt("0x"+V(O.slice(4,6))),N.errStr=M(O.slice(6,6+N.errStrlen)),e({type:"serverErr",status:"failed",msg:N})}},N.parseChatMoonServerMessage=function(R,e){var O=new Uint8Array(R),E=parseInt("0x"+V(O.slice(0,2)));switch(E){case AG_CHATROOMMOONSERVER._e:e({type:"createChatRoom",status:"success",chatroomId:_=M(O.slice(2,18)),maxContentLen:parseInt("0x"+V(O.slice(18,20)))});break;case AG_CHATROOMMOONSERVER.ae:var t=parseInt("0x"+V(O.slice(2,4)));e({type:"createChatRoom",status:"failed",status:M(O.slice(4,4+t))});break;case AG_CHATROOMMOONSERVER.re:e({type:"deleteChatRoom",status:"success",roomId:_=M(O.slice(2,18))});break;case AG_CHATROOMMOONSERVER.ne:var _=M(O.slice(2,18));t=parseInt("0x"+V(O.slice(18,20)));e({type:"deleteChatRoom",status:"failed",msg:M(O.slice(20,20+t)),roomId:_});break;case AG_CHATROOMMOONSERVER.se:var a=parseInt("0x"+V(O.slice(2,4)));e({type:"banaedToSendMsg",status:"success",banUserId:r=M(O.slice(4,4+a)),banTime:n=parseInt("0x"+V(O.slice(4+a,4+a+2)))});break;case AG_CHATROOMMOONSERVER.ce:a=parseInt("0x"+V(O.slice(2,4)));var r=M(O.slice(4,4+a)),n=parseInt("0x"+V(O.slice(4+a,4+a+2)));t=parseInt("0x"+V(O.slice(4+a+2,4+a+2+2)));e({type:"banaedToSendMsg",status:"failed",banUserId:r,banTime:n,msg:M(O.slice(4+a+2+2,4+a+2+2+t))});break;case AG_CHATROOMMOONSERVER.Se:var s=parseInt("0x"+V(O.slice(2,4)));e({type:"kickOutUser",status:"success",kickOutUserId:c=M(O.slice(4,4+s))});break;case AG_CHATROOMMOONSERVER.ie:s=parseInt("0x"+V(O.slice(2,4)));var c=M(O.slice(4,4+s));t=parseInt("0x"+V(O.slice(4+s,4+a+2)));e({type:"kickOutUser",status:"failed",kickOutUserId:c,msg:M(O.slice(4+s+2,4+s+2+t))});break;case AG_CHATROOMMOONSERVER.oe:case AG_CHATROOMMOONSERVER.Ne:e({type:"joinChatRoom",status:"success",roomId:_=M(O.slice(2,18)),maxContentLen:parseInt("0x"+V(O.slice(18,20)))});break;case AG_CHATROOMMOONSERVER.Ie:_=M(O.slice(2,18)),t=parseInt("0x"+V(O.slice(18,20)));e({type:"joinChatRoom",status:"failed",failedStatus:M(O.slice(20,20+t)),roomId:_});break;case AG_CHATROOMMOONSERVER.Ae:console.log("chatRoom心跳反馈");break;case AG_CHATROOMMOONSERVER.Me:case AG_CHATROOMMOONSERVER.Ve:var S=parseInt("0x"+V(O.slice(2,4))),i=M(O.slice(4,4+S)),o=parseInt("0x"+V(O.slice(4+S,4+S+4))),N=M(O.slice(4+S+4,4+S+4+o));e({type:E==AG_CHATROOMMOONSERVER.Me?"recvChatPrivateMsg":"recvChatMsg",status:"success",fromUserId:i,msg:N});break;case AG_CHATROOMMOONSERVER.Ce:e({type:"chatroomUserBannedMsg",status:"success",banTime:n=parseInt("0x"+V(O.slice(2,4)))});break;case AG_CHATROOMMOONSERVER.Te:e({type:"chatroomUserKicked",status:"success"});break;case AG_CHATROOMMOONSERVER.Pe:e({type:"sendMsgNoFree"});break;case AG_CHATROOMMOONSERVER.ue:(N={}).errId=parseInt("0x"+V(O.slice(2,4))),N.errStrlen=parseInt("0x"+V(O.slice(4,6))),N.errStr=M(O.slice(6,6+N.errStrlen)),e({type:"serverErr",status:"failed",msg:N});break;case AG_CHATROOMMOONSERVER.Le:e({type:"getRoomOnlineNum",status:"success",roomId:_=M(O.slice(2,18)),onlineNum:parseInt("0x"+V(O.slice(18,22)))});break;case AG_CHATROOMMOONSERVER.He:e({type:"saveToChatroomList",status:"success",roomId:_=M(O.slice(2,18))});break;case AG_CHATROOMMOONSERVER.be:e({type:"saveToChatroomList",status:"failed",roomId:_=M(O.slice(2,18))});break;case AG_CHATROOMMOONSERVER.me:e({type:"delFromToChatroomList",status:"success",roomId:_=M(O.slice(2,18))});break;case AG_CHATROOMMOONSERVER.ge:e({type:"delFromToChatroomList",status:"failed",roomId:_=M(O.slice(2,18))});break;case AG_CHATROOMMOONSERVER.we:var I=parseInt("0x"+V(O.slice(2,6)));e({type:"queryAllChatroomList",status:"success",listData:M(O.slice(6,6+I))})}},N.parseVoipMoonServerMessage=function(R,e){var O=new Uint8Array(R);switch(parseInt("0x"+V(O.slice(0,2)))){case AG_VOIPMOONSERVER.je:e({type:"voipCallingAck",status:"success"});break;case AG_VOIPMOONSERVER.$e:var E=parseInt("0x"+V(O.slice(2,4)));e({type:"voipCalling",status:"success",fingerprint:M(O.slice(4,4+E))});break;case AG_VOIPMOONSERVER.qe:(t={}).errId=parseInt("0x"+V(O.slice(2,4))),t.errStrlen=parseInt("0x"+V(O.slice(4,6))),t.errStr=M(O.slice(6,6+t.errStrlen)),e({type:"voipCalling",status:"failed",msg:t});break;case AG_VOIPMOONSERVER.Ze:E=parseInt("0x"+V(O.slice(2,4)));e({type:"voipResponseing",status:"success",fingerprint:M(O.slice(4,4+E))});break;case AG_VOIPMOONSERVER.RO:(t={}).errId=parseInt("0x"+V(O.slice(2,4))),t.errStrlen=parseInt("0x"+V(O.slice(4,6))),t.errStr=M(O.slice(6,6+t.errStrlen)),e({type:"voipResponseing",status:"failed",msg:t});break;case AG_VOIPMOONSERVER.eO:case AG_VOIPMOONSERVER.OO:break;case AG_VOIPMOONSERVER.EO:var t;(t={}).errId=parseInt("0x"+V(O.slice(2,4))),t.errStrlen=parseInt("0x"+V(O.slice(4,6))),t.errStr=M(O.slice(6,6+t.errStrlen)),e({type:"serverErr",status:"failed",msg:t})}},N.constructHeartBeatMsg=function(R){return new Uint8Array(h(y(R.toString(16))))}},StarRtc.StarManager=new function(){var t=this,R="starRTC v1.0.0",_="",a="",r="",n="",s="",e=null,c=null,S="";t.version=function(){return console.log(R),R},t.login=function(R,e,O,E){"WebSocket"in window?(r=(_=R)+"_"+(a=e),n=O,c=E,StarRtc.Instance.configModePulic?$.get("https://"+StarRtc.Instance.loginServerUrl+":"+StarRtc.Instance.loginServerPort+"/?userId="+r+"&authKey="+n,function(R,e){if(console.log("authKey 验证：",e,R),"success"===e){var O=JSON.parse(R);1==O.status?(s=O.data,$.get("https://"+StarRtc.Instance.msgScheduleUrl+":"+StarRtc.Instance.msgSchedulePort+"/?userId="+r,function(R,e){e="success";console.log("消息调度：",e,R);var O=JSON.parse(R);1==O.status?(S="wss://"+O.data,t.connect()):E({msg:"请求msg调度数据异常"},"connect failed")})):E({msg:"登录验证失败"},"connect failed")}else E({msg:"请求验证地址失败"},"connect failed")}):(s="free",S="wss://"+StarRtc.Instance.msgServerUrl+":"+StarRtc.Instance.msgServerWebsocketPort,t.connect())):(console.log("当前浏览器 Not support websocket"),E({msg:"当前浏览器 Not support websocket"},"connect failed"))},t.connect=function(){console.log("WebSocket："+S),(e=new WebSocket(S)).onerror=function(){console.log("WebSocket连接发生错误"),c({msg:"WebSocket连接发生错误"},"connect failed")},e.onopen=function(){console.log("WebSocket连接成功"),c({msg:"WebSocket连接成功"},"connect success"),t.startAuth()},e.onmessage=function(R){console.log("onmessage",R.data),c(R.data,"onmessage")},e.onclose=function(){console.log("WebSocket连接关闭"),c({msg:"WebSocket连接关闭"},"connect closed"),e=null}},t.close=function(){console.log("关闭WebSocket连接"),StarRtc.AUtils.clear(),null!=e&&e.close()},t.send=function(R){null!=e&&e.send(R)},t.getSingleMessage=function(R,e,O){var E=R.split("_");2==E.length&&(R=E[1]),c({fromId:R,digest:e,msg:O},"onSingleMessage")},t.getErrorMessage=function(R,e){c({errId:R,errStr:e},"onErrorMessage")},t.getGroupMessage=function(R,e,O,E){var t=e.split("_");2==t.length&&(e=t[1]);var _=R.split("_");2==_.length&&(R=_[1]),c({groupId:R,fromId:e,digest:O,msg:E},"onGroupMessage")},t.getGroupPrivateMessage=function(R,e,O,E){var t=e.split("_");2==t.length&&(e=t[1]);var _=R.split("_");2==_.length&&(R=_[1]),c({groupId:R,fromId:e,digest:O,msg:E},"onGroupPrivateMessage")},t.getGroupPushMessage=function(R,e,O){var E=R.split("_");2==E.length&&(R=E[1]),c({groupId:R,digest:e,msg:O},"onGroupPushMessage")},t.getSystemPushMessage=function(R,e){c({digest:R,msg:e},"onSystemPushMessage")},t.startAuth=function(){StarRtc.AUtils.setUserInfo(_,a,s),t.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.M,StarRtc.AUtils.constructAuthMsg()))},t.getLoginMessage=function(R){c(R,"onLoginMessage")},window.onbeforeunload=function(){t.close()}},StarRtc.Instance=new function(){var n=this,s="",c="",S="",t=null,E=null,_=0;n.configModePulic=!0,n.loginServerUrl="ips2.starrtc.com",n.loginServerPort="9920",n.msgScheduleUrl="ips2.starrtc.com",n.msgSchedulePort="9904",n.chatRoomScheduleUrl="ips2.starrtc.com",n.chatRoomSchedulePort="9907",n.srcScheduleUrl="ips2.starrtc.com",n.srcSchedulePort="9929",n.vdnScheduleUrl="ips2.starrtc.com",n.vdnSchedulePort="9926",n.voipServerUrl="voip2.starrtc.com",n.voipServerPort="10086",n.voipServerWebsocketPort="10087",n.voipServerWebrtcPort="10088",n.workServerUrl="https://api.starrtc.com/public",n.webrtcServerIP="123.103.93.74",n.msgServerUrl="ips2.starrtc.com",n.msgServerWebsocketPort="9904",n.chatRoomServerUrl="ips2.starrtc.com",n.chatRoomServerWebsocketPort="9907",n.srcServerUrl="ips2.starrtc.com",n.srcServerWebsocketPort="9929",n.srcServerWebrtcPort="10088",n.vdnServerUrl="ips2.starrtc.com",n.vdnServerWebsocketPort="9929",n.vdnServerWebrtcPort="10088",n.version=function(){return StarRtc.StarManager.version()};var a=function(R,e){switch(e){case"connect failed":case"connect success":case"connect closed":t(R,e);break;case"onmessage":StarRtc.AUtils.parseProtocol(R,function(R){switch(R.appid){case APP_PRODUCT_ID.R:StarRtc.AUtils.parseMessage(R.msgArr)}});break;case"onSingleMessage":R.msg=JSON.parse(R.msg);var O=e;if(0==R.msg.type)switch(R.msg.code){case AG_MSG_VOIP_CTRL.h:R.type="voipCall",O="onVoipMessage";break;case AG_MSG_VOIP_CTRL.F:R.type="voipRefuse",O="onVoipMessage";break;case AG_MSG_VOIP_CTRL.W:R.type="voipHangup",O="onVoipMessage";break;case AG_MSG_VOIP_CTRL.K:R.type="voipBusy",O="onVoipMessage";break;case AG_MSG_VOIP_CTRL.B:R.type="voipConnect",O="onVoipMessage";break;default:R.type="voipSingleMsg"}else R.type="voipSingleMsg";(null!=E?E:t)(R,O);break;case"onLoginMessage":case"onGroupMessage":case"onGroupPrivateMessage":case"onGroupPushMessage":case"onSystemPushMessage":case"onErrorMessage":null!=E&&E(R,e),t(R,e)}};n.setLoginServerUrl=function(R){n.loginServerUrl=R},n.setMsgScheduleUrl=function(R){n.msgScheduleUrl=R},n.setChatRoomScheduleUrl=function(R){n.chatRoomScheduleUrl=R},n.setSrcScheduleUrl=function(R){n.srcScheduleUrl=R},n.setVdnScheduleUrl=function(R){n.vdnScheduleUrl=R},n.setVoipServerUrl=function(R){n.voipServerUrl=R},n.setWorkServerUrl=function(R){n.workServerUrl=R},n.setWebrtcServerIP=function(R){n.webrtcServerIP=R},n.setMsgServerInfo=function(R,e){n.msgServerUrl=R,n.msgServerWebsocketPort=e},n.setchatRoomServerInfo=function(R,e){n.chatRoomServerUrl=R,n.chatRoomServerWebsocketPort=e},n.setSrcServerInfo=function(R,e,O){n.srcServerUrl=R,n.srcServerWebsocketPort=e,n.srcServerWebrtcPort=O},n.setVdnServerInfo=function(R,e,O){n.vdnServerUrl=R,n.vdnServerWebsocketPort=e,n.vdnServerWebrtcPort=O},n.setVoipServerInfo=function(R,e,O,E){n.voipServerUrl=R,n.voipServerPort=e,n.voipServerWebsocketPort=O,n.voipServerWebrtcPort=E},n.setConfigModePulic=function(R){n.configModePulic=R},n.login=function(R,e,O,E){n.configModePulic||(R="APPID-FREE"),(s=R)+"_"+(c=e),S=O,t=E,StarRtc.StarManager.login(R,e,O,a)},n.logout=function(){StarRtc.StarManager.close()},n.sendSingleMsg=function(R,e,O,E){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.M,StarRtc.AUtils.constructSingleMsg(R,++_,e,O,E)))},n.sendGroupMsg=function(R,e,O){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.M,StarRtc.AUtils.constructGroupMsg(R,++_,e,O)))},n.sendSingleCtrlMsg=function(R,e,O,E){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.M,StarRtc.AUtils.constructSingleCtrlMsg(R,++_,e,O,E)))},n.sendVoipCtrlMsg=function(R,e){var O="";e==AG_MSG_VOIP_CTRL.h&&(O=JSON.stringify({VoIP_protocal_type:"TCP",VoIP_server_IP:StarRtc.Instance.voipServerUrl,VoIP_server_Port:StarRtc.Instance.voipServerPort})),n.sendSingleCtrlMsg(R,"新消息",O,e)},n.sendVoipCallMsg=function(R,e){var O,E=e||(new Date).getTime();O=JSON.stringify({VoIP_protocal_type:"TCP",VoIP_server_IP:StarRtc.Instance.voipServerUrl,VoIP_server_Port:StarRtc.Instance.voipServerPort,ts:E}),n.sendSingleCtrlMsg(R,"新消息",O,AG_MSG_VOIP_CTRL.h)},n.sendVoipRefuseMsg=function(R){n.sendVoipCtrlMsg(R,AG_MSG_VOIP_CTRL.F)},n.sendVoipHungupMsg=function(R){n.sendVoipCtrlMsg(R,AG_MSG_VOIP_CTRL.W),null!=E&&E({type:"voipCancle"},"onVoipMessage")},n.sendVoipBusyMsg=function(R){n.sendVoipCtrlMsg(R,AG_MSG_VOIP_CTRL.K)},n.sendVoipConnectMsg=function(R){n.sendVoipCtrlMsg(R,AG_MSG_VOIP_CTRL.B)},n.setIMExtraback=function(R){E=R},n.getStarRoomSDK=function(R,e,O,E,t,_,a){var r=new StarRtc.StarRoomSDK(R,e,O,E,t,_,a);return r.login(s,c,S),r},n.getVideoMeetingRoomSDK=function(R,e,O){return n.getStarRoomSDK("src",R,e,O,3,1)},n.getVideoLiveRoomSDK=function(R,e,O,E){return n.getStarRoomSDK(R,e,O,E,3,2)},n.getVoipRoomSDK=function(R,e,O){return n.getStarRoomSDK("voip",R,e,O,2,0,n)},n.reportRoom=function(O,R,E){if(!StarRtc.Instance.configModePulic){var t=null,_=R.ID.substring(16,33);rf={},rf.id=R.ID,rf.creator=R.Creator,rf.name=R.Name;var a=function(R,e){switch(R.obj=n,e){case"connect success":t.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.O,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.de,{roomId:_,listType:O,userDefineData:encodeURIComponent(JSON.stringify(rf))})));break;case"connect failed":E("failed");case"connect closed":t=null;break;case"onmessage":StarRtc.AUtils.parseProtocol(R,function(R){R.appid==APP_PRODUCT_ID.O&&StarRtc.AUtils.parseChatMoonServerMessage(R.msgArr,function(R){a(R,"onChatRoomMessage")})});break;case"onChatRoomMessage":switch(R.type){case"saveToChatroomList":E(R.status),t.close()}}};t=new StarRtc.WebrtcWebsocket(a,null);var e="wss://"+StarRtc.Instance.chatRoomServerUrl+":"+StarRtc.Instance.chatRoomServerWebsocketPort;t.connect(e)}},n.delRoom=function(){if(!StarRtc.Instance.configModePulic){var O=null,E=function(R,e){switch(R.obj=n,e){case"connect success":O.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.O,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.ke,{roomId:roomId,listType:listType})));break;case"connect failed":callback("failed");case"connect closed":O=null;break;case"onmessage":StarRtc.AUtils.parseProtocol(R,function(R){R.appid==APP_PRODUCT_ID.O&&StarRtc.AUtils.parseChatMoonServerMessage(R.msgArr,function(R){E(R,"onChatRoomMessage")})});break;case"onChatRoomMessage":switch(R.type){case"delFromToChatroomList":callback(R.status),O.close()}}};O=new StarRtc.WebrtcWebsocket(E,null);var R="wss://"+StarRtc.Instance.chatRoomServerUrl+":"+StarRtc.Instance.chatRoomServerWebsocketPort;O.connect(R)}},n.queryVideoMeetingRoom=function(R){n.queryRoom(CHATROOM_LIST_TYPE.$,R)},n.queryVideoLiveRoom=function(R){n.queryRoom(CHATROOM_LIST_TYPE.j,R)},n.queryRoom=function(t,_){if(!StarRtc.Instance.configModePulic){var a=null,r=function(R,e){switch(R.obj=n,e){case"connect success":a.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.O,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.ye,{listTypes:t.toString(),userId:""})));break;case"connect failed":_("failed");case"connect closed":a=null;break;case"onmessage":StarRtc.AUtils.parseProtocol(R,function(R){R.appid==APP_PRODUCT_ID.O&&StarRtc.AUtils.parseChatMoonServerMessage(R.msgArr,function(R){r(R,"onChatRoomMessage")})});break;case"onChatRoomMessage":switch(R.type){case"queryAllChatroomList":for(var O=JSON.parse(R.listData).userDefineDataList.split(","),E=0;E<O.length;E++)O[E]=JSON.parse(decodeURIComponent(O[E])),O[E].ID=O[E].id,O[E].Name=O[E].name,O[E].Creator=O[E].creator;_(R.status,O),a.close()}}};a=new StarRtc.WebrtcWebsocket(r,null);var R="wss://"+StarRtc.Instance.chatRoomServerUrl+":"+StarRtc.Instance.chatRoomServerWebsocketPort;a.connect(R)}}},StarRtc.WebrtcWebsocket=function(R,e){var O,E=this,t=e,_=R,a=null;return E.startHeartBeat=function(R){a.send(R),O=setInterval(function(){a.send(R)},5e3)},E.stopHeartBeat=function(){clearInterval(O)},E.connect=function(R){console.log("webrtcConnect"+R),(a=new WebSocket(R)).onerror=function(R){console.log("WebSocket连接发生错误"),_({msg:"WebSocket连接发生错误",data:R.data},"connect failed")},a.onopen=function(){console.log("WebSocket连接成功"),_({msg:"WebSocket连接成功"},"connect success")},a.onmessage=function(R){console.log("onmessage",R.data),_(R.data,"onmessage")},a.onclose=function(R){console.log("WebSocket连接关闭"),E.stopHeartBeat(),_({msg:"WebSocket连接关闭",data:R.code},"connect closed"),a=null}},E.starConnect=function(E){$.get(t,function(R,e){if(console.log("消息调度：",e,R),"success"===e){var O=JSON.parse(R);1==O.status?E("success",O.data):E("failed")}else E("failed")})},E.send=function(R){a.send(R)},E.close=function(){null!=a&&a.close()},E.readyState=function(){return null!=a?a.readyState:-1},E},StarRtc.StarRoomSDK=function(R,e,O,E,t,_,a){var r="我要上麦！",n=this,s="",c=e,S=R,i=E,o=O,N=t||3,I=0!=(1&N),A=0!=(2&N),M=null,V=null,C=null,T=null,P=!1,u=null,L=a;function G(){null!=u&&(clearInterval(u),u=null)}function l(R){if(null!=R){var e=R.getState();0<=e&&e<2&&R.sigDisconnect()}}function f(){var R=!0;return I&&(R=R&&(3==C.getState()||-1==C.getState())),A&&(R=R&&(3==M.getState()||-1==M.getState())),R}null!=L&&"voip"==R&&L.setIMExtraback(function(R,e){D(R,"onVoipMessage")});var D=function(R,e){switch(R.userData=i,R.obj=n,e){case"connect success":A?M.sigConnect():o(R,e,c);break;case"connect failed":case"connect closed":A&&l(M),f()&&o(R,e,c);break;case"onmessage":break;case"onChatRoomMessage":switch(R.type){case"createChatRoom":"success"==R.status&&(i.roomInfo.ID=R.chatroomId,i.roomInfo.Creator=s,A&&(V.roomInfo.Name=R.chatroomId,M.createNew()));break;case"deleteChatRoom":"success"==R.status&&(A?M.deleteCurrRoom():o(R,e,c));break;case"joinChatRoom":"success"==R.status&&A&&M.joinRoom();break;case"recvChatPrivateMsg":if(0==R.msg.type)switch(R.msg.code){case 2e3:R.msg.msgType="apply";break;case 2002:R.msg.msgType="applyAgree";break;case 2004:R.msg.msgType="applyDisagree";break;case 2200:R.msg.msgType="linkStop";break;case 2100:R.msg.msgType="invite";break;case 2102:R.msg.msgType="inviteAgree";break;case 2106:R.msg.msgType="inviteDisagree";break;case 2104:R.msg.msgType="inviteLinkStart";break;default:R.msg.msgType="common"}}o(R,e,c);break;case"onVoipMessage":switch(R.type){case"voipCall":R.fromId!=i.roomInfo.targetId&&L.sendVoipBusyMsg(R.fromId);break;case"voipHangup":R.fromId==i.roomInfo.targetId&&(n.leaveRoom(!0),o(R,e,c));break;case"voipBusy":G(),n.leaveRoom(!0),o(R,e,c);break;case"voipConnect":case"voipRefuse":G(),o(R,e,c);break;case"voipCancle":G();break;default:o(R,e,c)}}};return V=clone(i),T=clone(i),A&&I&&i.roomInfo.ID&&(V.roomInfo.ID=i.roomInfo.ID.substring(0,16),T.roomInfo.ID=i.roomInfo.ID.substring(16,33)),A&&(M=new StarRtc.StarVideoSDK(R,e,function(R,e){switch(R.userData=i,R.obj=n,e){case"connect success":o(R,e,c);break;case"connect closed":case"connect failed":G(),I&&l(C),f()&&o(R,e,c);break;case"onmessage":break;case"onWebrtcMessage":switch(R.type){case"delChannel":"success"==R.status?o(R,e,c):alert("删除视频会议失败");break;case"createChannel":"success"==R.status&&(i.roomInfo.Creator=s,i.roomInfo.ID=I?R.channelId+i.roomInfo.ID:R.channelId),o(R,e,c);break;case"voipCallingAck":if(null!=L){G();var O=(new Date).getTime();L.sendVoipCallMsg(i.roomInfo.targetId,O),_=i.roomInfo.targetId,E=function(){L.sendVoipCallMsg(_,O)},t=3e3,null!=u&&G(),u=setInterval(E,t)}break;case"voipResponseing":"success"==R.status&&null!=L&&L.sendVoipConnectMsg(i.roomInfo.targetId),o(R,e,c);break;default:o(R,e,c)}}var E,t,_},V,_)),I&&(C=new StarRtc.StarChatSDK(e,D,T)),n.login=function(R,e,O){R+"_"+(s=e),O,I&&C.login(R,e,O),A&&M.login(R,e,O)},n.sigConnect=function(){P=!1,I?C.sigConnect():A&&M.sigConnect()},n.sigDisconnect=function(R){null==R&&(R=!0),P=R,A?M.sigDisconnect():I&&C.sigDisconnect()},n.createNew=function(){"voip"!=S&&(I?C.createNew():A&&M.createNew())},n.deleteCurrRoom=function(){"voip"!=S&&(I?C.deleteCurrRoom():A&&M.deleteCurrRoom())},n.createStream=function(R){A&&M.createStream(R)},n.joinRoom=function(){I&&"new"!=c?C.joinRoom():A&&M.joinRoom()},n.leaveRoom=function(R){if(A){switch(S){case"voip":var e=R||!1;null==L||e||L.sendVoipHungupMsg(i.roomInfo.targetId),L.setIMExtraback(null)}M.leaveRoom(e)}else I&&C.leaveRoom()},n.streamConfigChange=function(R){A&&M.streamConfigChange(R)},n.sendChatMsg=function(R){I&&C.sendChatMsg(R)},n.sendVoipMsg=function(R){"voip"==S&&null!=L&&L.sendSingleMsg(i.roomInfo.targetId,"新媒体",R)},n.sendChatPrivateMsg=function(R,e){I&&C.sendChatPrivateMsg(R,e)},n.sendApplyMsg=function(){I&&A&&"vdn"==S&&C.sendChatCtrlPrivateMsg(i.roomInfo.Creator,r,2e3)},n.sendApplyAgreeMsg=function(R){I&&A&&"src"==S&&C.sendChatCtrlPrivateMsg(R,r,2002)},n.sendApplyDisagreeMsg=function(R){I&&A&&"src"==S&&C.sendChatCtrlPrivateMsg(R,r,2004)},n.sendInviteLinkMsg=function(R){I&&A&&"src"==S&&C.sendChatCtrlPrivateMsg(R,r,2100)},n.sendInviteLinkAgreeMsg=function(){I&&A&&"vdn"==S&&C.sendChatCtrlPrivateMsg(i.roomInfo.Creator,r,2102)},n.sendInviteLinkDisagreeMsg=function(){I&&A&&"vdn"==S&&C.sendChatCtrlPrivateMsg(i.roomInfo.Creator,r,2106)},n.sendInviteLinkStartMsg=function(){I&&A&&"vdn"==S&&C.sendChatCtrlPrivateMsg(i.roomInfo.Creator,r,2104)},n.sendLinkStopMsg=function(R){I&&A&&"src"==S&&C.sendChatCtrlPrivateMsg(R,r,2200)},n.kickOutUser=function(R){I&&C.kickOutUser(R)},n.banToSendMsg=function(R,e){I&&C.banToSendMsg(R,e)},n.getRoomOnlineNum=function(){I&&C.getRoomOnlineNum()},n.sendStreamData=function(R){A&&"src"==S&&M.sendStreamData(R)},n.activeDisconnect=function(){return P},n},StarRtc.StarVideoSDK=function(R,e,O,E,t){var n,s,c=this,S="",i="",o=E,N=R,I=O,A=e,M=null,V="",C={},T={},_=t||1,P={siv:0,uperInfos:{}},u=StarWebRTC();u.init();var L=!1,a=!1,r=function(R){switch(R.type){case"createOffer":if("success"==R.status){switch(N){case"src":R.channelId=o.roomInfo.ID;break;case"vdn":R.ssrc=R.bigVideoSSRC;break;case"voip":R.targetId=o.roomInfo.targetId,R.videoSSRC=R.bigVideoSSRC}c.joinRoomInternal(R)}break;case"applyAnswer":R.status}},G=function(R,e){var O={type:"streamCreated",streamObj:e};O.userData=o,O.obj=c,O.status="success"==R?"success":"failed",I(O,"onWebrtcMessage",A)},l=function(R,e){switch(R.userData=o,R.obj=c,e){case"connect success":var O=null;switch(N){case"src":O=StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.i,ACTION_GROUP_ID.T,StarRtc.AUtils.constructHeartBeatMsg(AG_LIVESRCMOONSERVER.EE));break;case"vdn":O=StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.o,ACTION_GROUP_ID.T,StarRtc.AUtils.constructHeartBeatMsg(AG_LIVEVDNMOONSERVER.wE))}M.startHeartBeat(O),u.setServerInfo({serverIp:C.ip,serverPort:C.webrtcPort}),I(R,e,A);break;case"connect failed":case"connect closed":u.destroy(),M=null,I(R,e,A);break;case"onmessage":StarRtc.AUtils.parseProtocol(R,function(R){R.appid==APP_PRODUCT_ID.i?StarRtc.AUtils.parseSrcMoonServerMessage(R.msgArr,function(R){l(R,"onWebrtcMessage")}):R.appid==APP_PRODUCT_ID.o?StarRtc.AUtils.parseVdnMoonServerMessage(R.msgArr,function(R){l(R,"onWebrtcMessage")}):R.appid==APP_PRODUCT_ID.N&&StarRtc.AUtils.parseVoipMoonServerMessage(R.msgArr,function(R){l(R,"onWebrtcMessage")})});break;case"onWebrtcMessage":switch(R.type){case"uperStreamInfoUpdate":if("success"==R.status){if(L)for(var E=0;E<7;++E){var t=u.getStreamByIndex(E),_=void 0;0!=Object.keys(P.uperInfos).length&&(_=P.uperInfos[E]);var a=R.msg.uperInfos[E];if(null==_&&null!=a)a.userId!=i&&I({type:"addUploader",upId:a.upId,upUserId:a.userId,streamInfo:t,room:c},e,A);else if(null!=_&&null==a){var r=s==_.upId;r&&(s=n=void 0),u.resetStreamInfo(t),I({type:"removeUploader",upId:_.upId,upUserId:_.userId,streamInfo:t,bigFlag:r,room:c},e,A)}else null!=_&&null!=a&&_.userId!=a.userId&&I({type:"changeUploader",upId:a.upId,oldUpUserId:_.userId,newUpUserId:a.userId,streamInfo:t,room:c},e,A)}P=R.msg}break;case"vdnWebrtcReg":if("success"==R.status)switch(N){case"vdn":V=R.fingerprint,M.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.o,ACTION_GROUP_ID.T,StarRtc.AUtils.constructVdnProtocol(AG_LIVEVDNMOONSERVER.gE,{channelId:o.roomInfo.ID})))}else console.log("vdnWebrtcReg failed");break;case"vdnApplyDownload":"success"==R.status?u.emit("_webrtc_apply_ok",V,function(){L=!0,l({type:"uperStreamInfoUpdate",status:"success",msg:R.uperInfos},"onWebrtcMessage")}):console.log("收到vdnApplyDownload failed"),I(R,e,A);break;case"srcApplyUpload":"success"==R.status?(R.tmpData=T,console.log("收到_webrtc_apply_ok"),u.emit("_webrtc_apply_ok",R.fingerprint,function(){L=!0;var R=clone(P);P.uperInfos={},l({type:"uperStreamInfoUpdate",status:"success",msg:R},"onWebrtcMessage")})):console.log("收到srcApplyUpload failed"),I(R,e,A);break;case"streamConfig":if("success"==R.status){if(n==s){t=u.getStreamByIndex(n);u.switchStreamInfo(t);break}if(null!=n){t=u.getStreamByIndex(n);u.switchStreamInfo(t)}if(null!=s){t=u.getStreamByIndex(s);u.switchStreamInfo(t)}}break;case"createChannel":"success"==R.status&&(o.roomInfo.ID=R.channelId,o.roomInfo.Creator=S),I(R,e,A);break;case"delChannel":"success"==R.status&&(o.roomInfo.ID=""),I(R,e,A);break;case"serverErr":break;case"voipResponseing":case"voipCalling":"success"==R.status&&(console.log("收到_webrtc_apply_ok"),u.emit("_webrtc_apply_ok",R.fingerprint,function(){l({type:"voipStreamReady",status:"success"},"onWebrtcMessage")})),I(R,e,A);break;case"voipStreamReady":t=u.getStreamByIndex(0);u.switchStreamInfo(t),I({type:"voipStreamReady",streamObj:t.streamObj,room:c},e,A);break;default:I(R,e,A)}}};return c.login=function(R,e,O){i=R+"_"+(S=e),O},c.sigConnect=function(){switch(a=!1,C.ip=StarRtc.Instance.webrtcServerIP,M=null,N){case"src":if(!StarRtc.Instance.configModePulic){M=new StarRtc.WebrtcWebsocket(l,null),(O={}).ip=StarRtc.Instance.srcServerUrl,C.websocketPort=StarRtc.Instance.srcServerWebsocketPort,C.webrtcPort=StarRtc.Instance.srcServerWebrtcPort,O.websocketPort=C.websocketPort;var R="wss://"+O.ip+":"+O.websocketPort;return void M.connect(R)}var e="https://"+StarRtc.Instance.srcScheduleUrl+":"+StarRtc.Instance.srcSchedulePort+"?userId="+i;M=new StarRtc.WebrtcWebsocket(l,e);break;case"vdn":if(!StarRtc.Instance.configModePulic){M=new StarRtc.WebrtcWebsocket(l,null),(O={}).ip=StarRtc.Instance.vdnServerUrl,C.websocketPort=StarRtc.Instance.vdnServerWebsocketPort,C.webrtcPort=StarRtc.Instance.vdnServerWebrtcPort,O.websocketPort=C.websocketPort;R="wss://"+O.ip+":"+O.websocketPort;return void M.connect(R)}e="https://"+StarRtc.Instance.vdnScheduleUrl+":"+StarRtc.Instance.vdnSchedulePort+"?userId="+i+"&channelId="+o.channelId;M=new StarRtc.WebrtcWebsocket(l,e);break;case"voip":var O;M=new StarRtc.WebrtcWebsocket(l,null),(O={}).ip=StarRtc.Instance.voipServerUrl,C.websocketPort=StarRtc.Instance.voipServerWebsocketPort,C.webrtcPort=StarRtc.Instance.voipServerWebrtcPort,O.websocketPort=C.websocketPort;R="wss://"+O.ip+":"+O.websocketPort;return void M.connect(R);default:return}M.starConnect(function(R,e){if("success"==R){C.websocketPort=e.websocketPort,C.webrtcPort=e.webrtcPort;var O="wss://"+e.ip+":"+e.websocketPort;M.connect(O)}})},c.sigDisconnect=function(R){null==R&&(R=!0),a=R,null!=M&&(M.close(),M=null)},c.createNew=function(){if(null!=M)switch(N){case"src":var R="1";2==_&&(R="2");var e=AG_LIVESRCMOONSERVER.xO;M.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.i,ACTION_GROUP_ID.T,StarRtc.AUtils.constructSrcProtocol(e,{conCurrentNum:7,roomId:o.roomInfo.Name,extra:R,liveType:parseInt(R)})))}},c.deleteCurrRoom=function(){if(null!=M)switch(N){case"src":M.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.i,ACTION_GROUP_ID.T,StarRtc.AUtils.constructSrcProtocol(AG_LIVESRCMOONSERVER.ZO,{channelId:o.roomInfo.ID})))}},c.createStream=function(R){null==R&&(R={video:{width:{ideal:640},height:{ideal:480},frameRate:{ideal:25},facingMode:{ideal:["user"]}},audio:{deviceId:{ideal:["default"]}}}),u.createStream(R,G)},c.joinRoom=function(){u.emit("ready",r,"voip"==N)},c.joinRoomInternal=function(R){switch(T=R,N){case"src":M.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.i,ACTION_GROUP_ID.T,StarRtc.AUtils.constructWebrtcUploadMsgProtocol(R)));break;case"vdn":M.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.o,ACTION_GROUP_ID.T,StarRtc.AUtils.constructVdnProtocol(AG_LIVEVDNMOONSERVER.mE,R)));break;case"voip":"call"==A?M.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.N,ACTION_GROUP_ID.P,StarRtc.AUtils.constructVOIPProtocol(AG_VOIPMOONSERVER.Fe,R))):"response"==A&&M.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.N,ACTION_GROUP_ID.P,StarRtc.AUtils.constructVOIPProtocol(AG_VOIPMOONSERVER.Ke,R)))}},c.leaveRoom=function(R){if(null!=M&&1==M.readyState())switch(N){case"src":M.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.i,ACTION_GROUP_ID.T,StarRtc.AUtils.constructSrcProtocol(AG_LIVESRCMOONSERVER.zO,{channelId:o.roomInfo.ID})));break;case"vdn":M.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.o,ACTION_GROUP_ID.T,StarRtc.AUtils.constructVdnProtocol(AG_LIVEVDNMOONSERVER.yE,{})));case"voip":M.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.N,ACTION_GROUP_ID.P,StarRtc.AUtils.constructVOIPProtocol(AG_VOIPMOONSERVER.Qe,{isActive:R?0:1})))}},c.streamConfigChange=function(R){if(null!=M){s==R?(s=n,n=R):(n=s,s=R);var e=u.getStreamInfos(),O=[];for(var E in e){var t=0;t=n==s?e[E].switchFlag?1:2:E==n?1:E==s?2:e[E].switchFlag?2:1,O.push(t)}switch(N){case"src":M.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.i,ACTION_GROUP_ID.T,StarRtc.AUtils.constructSrcProtocol(AG_LIVESRCMOONSERVER.RE,{streamConfig:O})));break;case"vdn":M.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.o,ACTION_GROUP_ID.T,StarRtc.AUtils.constructVdnProtocol(AG_LIVEVDNMOONSERVER.YE,{streamConfig:O})))}}},c.getState=function(){return null!=M?M.readyState():-1},c.getType=function(){return N},c.sendStreamData=function(R){switch(N){case"src":M.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.i,ACTION_GROUP_ID.T,StarRtc.AUtils.constructSrcProtocol(AG_LIVESRCMOONSERVER.OE,{streamData:R,streamDataType:8})))}},c.activeDisconnect=function(){return a},c},StarRtc.StarChatSDK=function(R,e,O){var E=this,t="",_="",a={},r=O,n=e,s=R,c=null,S=0,i=!1,o=function(R,e){switch(R.userData=r,R.obj=E,e){case"connect success":var O;O=StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.O,ACTION_GROUP_ID.V,StarRtc.AUtils.constructHeartBeatMsg(AG_CHATROOMMOONSERVER.zR)),c.startHeartBeat(O),n(R,e,s);break;case"connect failed":case"connect closed":c=null,n(R,e,s);break;case"onmessage":StarRtc.AUtils.parseProtocol(R,function(R){R.appid==APP_PRODUCT_ID.O&&StarRtc.AUtils.parseChatMoonServerMessage(R.msgArr,function(R){o(R,"onChatRoomMessage")})});break;case"onChatRoomMessage":switch(R.type){case"createChatRoom":"success"==R.status&&(r.roomInfo.ID=R.chatroomId,r.roomInfo.Creator=t);break;case"deleteChatRoom":case"joinChatRoom":R.status;break;case"recvChatPrivateMsg":case"recvChatMsg":if(""==R.fromUserId||""==R.msg)return;if(R.msg=JSON.parse(R.msg),R.msg.fromId==t)return}n(R,e,s)}};return E.login=function(R,e,O){_=R+"_"+(t=e),O},E.sigConnect=function(){if(i=!1,StarRtc.Instance.configModePulic){var R="https://"+StarRtc.Instance.chatRoomScheduleUrl+":"+StarRtc.Instance.chatRoomSchedulePort+"/?userId="+_;(c=new StarRtc.WebrtcWebsocket(o,R)).starConnect(function(R,e){if("success"==R){var O=e.split(":");a.ip=O[0],a.port=O[1];var E="wss://"+a.ip+":"+a.port;c.connect(E)}})}else{c=new StarRtc.WebrtcWebsocket(o,null),a.ip=StarRtc.Instance.chatRoomServerUrl,a.port=StarRtc.Instance.chatRoomServerWebsocketPort;var e="wss://"+a.ip+":"+a.port;c.connect(e)}},E.sigDisconnect=function(R){null==R&&(R=!0),i=R,null!=c&&(c.close(),c=null)},E.createNew=function(){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.O,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.jR,{roomType:0==r.roomInfo.Type?1:2,conCurrentNum:100,userDefineData:r.roomInfo.Name})))},E.sendChatMsg=function(R){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.O,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.Oe,{roomId:r.roomInfo.ID,digest:"新消息",msgIndex:++S,msg:R})))},E.sendChatPrivateMsg=function(R,e){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.O,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.Ee,{toUserId:R,roomId:r.roomInfo.ID,digest:"新消息",msgIndex:++S,msg:e,type:"1",code:"0"})))},E.sendChatCtrlPrivateMsg=function(R,e,O){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.O,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.Ee,{toUserId:R,roomId:r.roomInfo.ID,digest:"新消息",msgIndex:++S,msg:e,type:"0",code:O})))},E.kickOutUser=function(R){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.O,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.qR,{kickOutUserId:R})))},E.banToSendMsg=function(R,e){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.O,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.$R,{banUserId:R,banTime:e})))},E.getRoomOnlineNum=function(){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.O,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.te,{roomId:r.roomInfo.ID})))},E.deleteCurrRoom=function(){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.O,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.XR)))},E.joinRoom=function(){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.O,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.ZR,{roomId:r.roomInfo.ID})))},E.leaveRoom=function(){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.O,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.ee)))},E.getState=function(){return null!=c?c.readyState():-1},E.activeDisconnect=function(){return i},E};